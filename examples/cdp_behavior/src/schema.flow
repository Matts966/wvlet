schema weblogs:
  td_client_id: string,
  td_host: string,
  td_path: string,
  td_title: string,
  td_description: string,
  td_ip: ip_address,
  td_url: url,
  td_charset: string,
  td_browser_version: string,
  td_os: string,
  td_browser: string,
  td_referrer: string,
  td_version: string,
  td_language: string,
  td_color: string,
  td_os_version: string,
  td_user_agent: user_agent,
  td_platform: string,
  td_screen: string,
  td_global_id: string,
  td_viewport: string,
  _col0: int,
  time: int,
end

type ip_address(self: string):
  def country_name = td_ip_to_country_name(self)
  def city_name = td_ip_to_city_name(self)
  def city_latitude = td_ip_to_latitude(self)
  def city_longitude = td_ip_to_longitude(self)
  def city_metro_code = td_ip_to_metro_code(self)
  def city_time_zone = td_ip_to_time_zone(self)
  def city_postal_code =  td_ip_to_postal_code(self)
  def least_specific_subdivision_name = td_ip_to_least_specific_subdivision_name(self)
  def most_specific_subdivision_name = td_ip_to_most_specific_subdivision_name(self)
  def subdivision_names = td_ip_to_subdivision_names(self)
  def connection_type = td_ip_to_connection_type(self)
  def domain = td_ip_to_domain(self)
end

type user_agent(self: string):
  def category = td_parse_agent(self)['category']
  def name = td_parse_agent(self)['name']
  def os = td_parse_agent(self)['os']
  def os_version =  td_parse_agent(self)['os_version']
  def vendor = td_parse_agent(self)['vendor']
  def version = td_parse_agent(self)['version']
end

type url(self: string):
  def utm_campaign = parse_url(self, 'QUERY', 'utm_campaign')
  def utm_medium = parse_url(self, 'QUERY', 'utm_medium')
  def utm_source = parse_url(self, 'QUERY', 'utm_source')
end

-- TODO Support parting this syntax
-- type string(self: string):
--   def regexp_like(regex: string): string = engine() match
--      case 'duckdb' then regexp_matches(self, regex)
--      case _ then regexp_like(self, regex)
--   end
-- end

schema weblog_users:
  td_client_id: string,
  name: string,
  age: int,
  gender: string,
  email: string,
  phone: string,
  address: string,
  naid: string,
  time: int,
end

schema weblog_user_attr3:
  td_client_id: string,
  age: int,
  very_long_attr_for_test_cdp_465: string,
  time: int,
end

schema weblog_user_attr2:
  td_client_id: string,
  td_language: string,
  td_os: string,
  time: int,
end

schema weblog_users_first_purchased_at:
  naid: string,
  first_purchased_at: int,
  time: int,
end

