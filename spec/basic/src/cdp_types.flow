package cdp

type td_sdk_log:
  td_client_id: string
  td_host: string
  td_path: string
  td_title: string
  td_description: string
  td_ip: ip_address
  td_url: url
  td_charset: string
  td_browser_version: string
  td_os: string
  td_browser: string
  td_referrer: string
  td_version: string
  td_language: string
  td_color: string
  td_os_version: string
  td_user_agent: user_agent
  td_platform: string
  td_screen: string
  td_global_id: string
  td_viewport: string
  _col0: int
  time: int
end

type ip_address(using trino):
  def country_name = sql"td_ip_to_country_name(${this})"
  def city_name = sql"td_ip_to_city_name(${this})"
  def city_latitude = sql"td_ip_to_latitude(${this})"
  def city_longitude = sql"td_ip_to_longitude(${this})"
  def city_metro_code = sql"td_ip_to_metro_code(${this})"
  def city_time_zone = sql"td_ip_to_time_zone(${this})"
  def city_postal_code =  sql"td_ip_to_postal_code(${this})"
  def least_specific_subdivision_name = sql"td_ip_to_least_specific_subdivision_name(${this})"
  def most_specific_subdivision_name = sql"td_ip_to_most_specific_subdivision_name(${this})"
  def subdivision_names = sql"td_ip_to_subdivision_names(${this})"
  def connection_type = sql"td_ip_to_connection_type(${this})"
  def domain = sql"td_ip_to_domain(${this})"
end

type ip_address(using duckdb):
  def country_name = sql"'N/A'"
  def city_name = sql"'N/A'"
  def city_latitude = sql"'N/A'"
  def city_longitude = sql"'N/A'"
  def city_metro_code = sql"'N/A'"
  def city_time_zone = sql"'N/A'"
  def city_postal_code =  sql"'N/A'"
  def least_specific_subdivision_name = sql"'N/A'"
  def most_specific_subdivision_name = sql"'N/A'"
  def subdivision_names = sql"'N/A'"
  def connection_type = sql"'N/A'"
  def domain = sql"'N/A'"
end

type user_agent(using trino):
  def category = sql"td_parse_agent(${this})('category')"
  def name = sql"td_parse_agent(${this})('name')"
  def os = sql"td_parse_agent(${this})('os')"
  def os_version =  sql"td_parse_agent(${this})('os_version')"
  def vendor = sql"td_parse_agent(${this})('vendor')"
  def version = sql"td_parse_agent(${this})('version')"
end

type user_agent(using duckdb):
  def category = sql"'N/A'"
  def name = sql"'N/A'"
  def os = sql"'N/A'"
  def os_version =  sql"'N/A'"
  def vendor = sql"'N/A'"
  def version = sql"'N/A'"
end

type url(using trino):
  def utm_campaign = parse_url(this, 'QUERY', 'utm_campaign')
  def utm_medium = parse_url(this, 'QUERY', 'utm_medium')
  def utm_source = parse_url(this, 'QUERY', 'utm_source')
end


type url(using duckdb):
  def utm_campaign = sql"'N/A'"
  def utm_medium = sql"'N/A'"
  def utm_source = sql"'N/A'"
end
